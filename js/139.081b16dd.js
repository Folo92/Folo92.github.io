"use strict";(self["webpackChunkyun_admin"]=self["webpackChunkyun_admin"]||[]).push([[139],{556:function(e,t,a){a.r(t),a.d(t,{default:function(){return R}});var i=a(3396),l=a(7139),s=a(9242);const n={class:"app-container"},o={class:"chapter-list"},r={class:"chapter-list-container"},c=(0,i._)("div",{class:"el-upload__text"},[(0,i.Uk)("Drop file here or "),(0,i._)("em",null,"click to upload")],-1),p=(0,i._)("div",{class:"el-upload__tip"},"txt files with a size less than 50mb",-1),d=(0,i._)("br",null,null,-1),h={style:{color:"#4490f1","font-size":"16px"}},u={class:"flex items-center"},g={style:{color:"var(--el-text-color-regular)","font-size":"16px"}},m=(0,i.Uk)("   "),f=(0,i.Uk)("Print"),w=(0,i.Uk)("Edit"),k={class:"flex items-center"},b=(0,i.Uk)("Print"),x=(0,i.Uk)("Edit"),_=(0,i._)("br",null,null,-1),y=["onClick"],L=(0,i.Uk)(" 阅读 ");function z(e,t,a,z,A,C){const v=(0,i.up)("upload-filled"),P=(0,i.up)("el-icon"),W=(0,i.up)("el-upload"),R=(0,i.up)("el-button"),U=(0,i.up)("el-page-header"),I=(0,i.up)("el-table-column"),S=(0,i.up)("el-table"),N=(0,i.up)("pagination"),D=(0,i.up)("YunReader");return(0,i.wg)(),(0,i.iD)("div",n,[(0,i.wy)((0,i._)("div",o,[(0,i._)("div",r,[(0,i.Wm)(W,{modelValue:A.fileList,"onUpdate:modelValue":t[0]||(t[0]=e=>A.fileList=e),ref:"upload",class:"upload-demo",action:"#","auto-upload":!1,drag:"","on-change":C.onChange},{tip:(0,i.w5)((()=>[p])),default:(0,i.w5)((()=>[(0,i.Wm)(P,{class:"el-icon--upload"},{default:(0,i.w5)((()=>[(0,i.Wm)(v)])),_:1}),c])),_:1},8,["modelValue","on-change"]),d,(0,i.Wm)(U,{icon:A.isAsc?"SortUp":"SortDown",onBack:C.sortChange,style:{color:"#4490f1","font-size":"16px"}},{title:(0,i.w5)((()=>[(0,i._)("span",h,(0,l.zw)(A.isAsc?"升序":"降序"),1)])),content:(0,i.w5)((()=>[(0,i._)("div",u,[(0,i._)("span",g,(0,l.zw)(A.bookName),1),m,(0,i.wy)((0,i._)("span",{class:"link-type",style:{"font-size":"14px"},onClick:t[1]||(t[1]=e=>C.readArticle())},"继续阅读",512),[[s.F8,""!=A.bookName]])])])),extra:(0,i.w5)((()=>[(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[f])),_:1}),(0,i.Wm)(R,{type:"primary",class:"ml-2"},{default:(0,i.w5)((()=>[w])),_:1}),(0,i._)("div",k,[(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[b])),_:1}),(0,i.Wm)(R,{type:"primary",class:"ml-2"},{default:(0,i.w5)((()=>[x])),_:1})])])),_:1},8,["icon","onBack"]),_,((0,i.wg)(),(0,i.j4)(S,{key:A.tableKey,data:A.list,border:"","table-layout":"fixed","max-height":1e3,onSortChange:C.sortChange},{default:(0,i.w5)((()=>[(0,i.Wm)(I,{label:"序号",width:"60px",align:"center"},{default:(0,i.w5)((e=>[(0,i.Uk)((0,l.zw)(e.$index+(A.listPagination.pageIndex-1)*A.listPagination.pageSize+1),1)])),_:1}),(0,i.Wm)(I,{prop:"title",label:"章节目录",minWidth:"160px",align:"left"},{default:(0,i.w5)((({row:e})=>[(0,i._)("span",{class:"link-type",onClick:t=>C.readArticle(e)},(0,l.zw)(e.title),9,y)])),_:1}),(0,i.Wm)(I,{label:"操作",align:"center",width:"120","class-name":"small-padding fixed-width"},{default:(0,i.w5)((({row:e})=>[(0,i.Wm)(R,{type:"primary",size:"small",onClick:t=>C.readArticle(e)},{default:(0,i.w5)((()=>[L])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSortChange"])),(0,i.wy)((0,i.Wm)(N,{total:A.total,page:A.listPagination.pageIndex,"onUpdate:page":t[2]||(t[2]=e=>A.listPagination.pageIndex=e),limit:A.listPagination.pageSize,"onUpdate:limit":t[3]||(t[3]=e=>A.listPagination.pageSize=e),onPagination:C.getList},null,8,["total","page","limit","onPagination"]),[[s.F8,A.total>0]])])],512),[[s.F8,!A.inReader]]),(0,i.wy)((0,i._)("div",null,[(0,i.Wm)(D,{ref:"reader",changeMode:C.changeMode,inReader:A.inReader,bookId:C.encode(A.bookName),bookName:A.bookName,articleData:A.articleData,chapterList:A.chapterList},null,8,["changeMode","inReader","bookId","bookName","articleData","chapterList"])],512),[[s.F8,A.inReader]])])}a(2801);var A=a(5691),C=a(1924),v={name:"BookList",components:{Pagination:A.Z,YunReader:C.Z},data(){return{fileList:[],file:null,bookText:"",chapterList:[],bookName:"",articleData:"",listPagination:{sort:"id",sortType:"desc",pageIndex:1,pageSize:15},tableKey:0,list:[],total:0,isAsc:!0,inReader:!1}},methods:{extractTitles(e){const t=/(正文){0,1}(第)([零〇一二三四五六七八九十百千万a-zA-Z0-9]{1,7})[章节卷集部篇回]((?! {4}).)((?!\t{1,4}).){0,30}\r?\n/g;let a=[],i=null;i=e.match(t),i&&a.push(...i);for(let l=0;l<a.length;l++)a[l]=a[l].replace("\r","").replace("\n","").replace("\t","");return a},getChapters(){var e=performance.now();const t=!1;this.list=[];const a=/^(第)([零〇一二三四五六七八九十百千万a-zA-Z0-9]{1,7})[章节卷集部篇回季](.){0,30}|^【(.{1,30})】$/,i=this.bookText;let l=i.replaceAll("\r\n","\n").replaceAll("\r","\n").split("\n").map((e=>e.trim())).filter((e=>e.length>0)),s=0,n=[],o=[];for(let c=0;c<l.length;c++){if(a.test(l[c]))if(0==c)o.push(l[c]);else{const e=l.slice(s,c);0==o.length&&0==s&&o.push("前言"),o.push(l[c]),n.push(e),s=c}if(c==l.length-1){const e=l.slice(s,c+1);0==o.length&&o.push(e[0].slice(0,10)),n.push(e)}}t&&console.log("chapters",n),t&&console.log("titles",o),this.chapterList=[];for(let c=0;c<n.length;c++)this.chapterList.push({id:c,title:o[c],content:n[c]});this.listPagination.pageIndex=1,this.getList();var r=performance.now();console.log("getChapters 耗时",r-e+"ms")},getList(){this.list=[],this.total=this.chapterList.length;const e=this.listPagination.pageIndex,t=this.listPagination.pageSize;if(this.isAsc){const a=(e-1)*t,i=a+t;for(let e=a;e<i&&e<this.total;e++)this.list.push({id:this.chapterList[e].id,title:this.chapterList[e].title})}else{const a=this.total-1-(e-1)*t,i=a-t;for(let e=a;e>i&&e>=0;e--)this.list.push({id:this.chapterList[e].id,title:this.chapterList[e].title})}},readArticle(e){this.inReader=!this.inReader,e&&(this.$refs.reader.currentChapter=e.id)},beforeAnalysis(e){const t="text/plain"==e.type,a=e.size/1024/1024<50;return t||this.$message.error("选择的文件只能是 txt 格式!"),a||this.$message.error("选择的文件大小不能超过 50MB!"),t&&a},encode(e){let t=encodeURI(e),a=btoa(t);return a},onChange(){this.$refs.upload.abort(),this.$refs.upload.clearFiles();var e=e||window.event,t=e.target.files[0];this.file=t,this.bookName=t.name.split(".").slice(0,-1).join("."),this.beforeAnalysis(t);var a=new FileReader;a.onload=e=>{const i=e.target.result;-1===i.indexOf("�")?(this.bookText=i,this.getChapters()):a.readAsText(t,"gb2312")},a.readAsText(t)},changeMode(){this.inReader=!this.inReader},sortChange(){this.isAsc=!this.isAsc,this.getList(),this.listPagination.pageIndex=1},goBack(){}}},P=a(89);const W=(0,P.Z)(v,[["render",z]]);var R=W}}]);
//# sourceMappingURL=139.081b16dd.js.map