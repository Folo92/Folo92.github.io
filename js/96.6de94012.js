"use strict";(self["webpackChunkyun_admin"]=self["webpackChunkyun_admin"]||[]).push([[96],{7014:function(e,t,i){i.r(t),i.d(t,{default:function(){return R}});var a=i(3396),l=i(7139),s=i(9242);const n={class:"app-container"},o={style:{width:"800px",margin:"0 auto"}},r=(0,a._)("div",{class:"el-upload__text"},[(0,a.Uk)("Drop file here or "),(0,a._)("em",null,"click to upload")],-1),c=(0,a._)("div",{class:"el-upload__tip"},"txt files with a size less than 50mb",-1),p=(0,a._)("br",null,null,-1),d={style:{color:"#4490f1","font-size":"16px"}},h={class:"flex items-center"},u={style:{color:"var(--el-text-color-regular)","font-size":"16px"}},g=(0,a.Uk)("   "),m=(0,a.Uk)("Print"),f=(0,a.Uk)("Edit"),w={class:"flex items-center"},k=(0,a.Uk)("Print"),x=(0,a.Uk)("Edit"),b=(0,a._)("br",null,null,-1),_=["onClick"],y=(0,a.Uk)(" 阅读 "),L={class:"filter-container"};function z(e,t,i,z,A,C){const v=(0,a.up)("upload-filled"),P=(0,a.up)("el-icon"),W=(0,a.up)("el-upload"),R=(0,a.up)("el-button"),U=(0,a.up)("el-page-header"),I=(0,a.up)("el-table-column"),S=(0,a.up)("el-table"),N=(0,a.up)("pagination"),D=(0,a.up)("YunReader");return(0,a.wg)(),(0,a.iD)("div",n,[(0,a.wy)((0,a._)("div",o,[(0,a.Wm)(W,{modelValue:A.fileList,"onUpdate:modelValue":t[0]||(t[0]=e=>A.fileList=e),ref:"upload",class:"upload-demo",action:"#","auto-upload":!1,drag:"","on-change":C.onChange},{tip:(0,a.w5)((()=>[c])),default:(0,a.w5)((()=>[(0,a.Wm)(P,{class:"el-icon--upload"},{default:(0,a.w5)((()=>[(0,a.Wm)(v)])),_:1}),r])),_:1},8,["modelValue","on-change"]),p,(0,a.Wm)(U,{icon:A.isAsc?"SortUp":"SortDown",onBack:C.sortChange,style:{color:"#4490f1","font-size":"16px"}},{title:(0,a.w5)((()=>[(0,a._)("span",d,(0,l.zw)(A.isAsc?"升序":"降序"),1)])),content:(0,a.w5)((()=>[(0,a._)("div",h,[(0,a._)("span",u,(0,l.zw)(A.bookName),1),g,(0,a.wy)((0,a._)("span",{class:"link-type",style:{"font-size":"14px"},onClick:t[1]||(t[1]=e=>C.readArticle())},"继续阅读",512),[[s.F8,""!=A.bookName]])])])),extra:(0,a.w5)((()=>[(0,a.Wm)(R,null,{default:(0,a.w5)((()=>[m])),_:1}),(0,a.Wm)(R,{type:"primary",class:"ml-2"},{default:(0,a.w5)((()=>[f])),_:1}),(0,a._)("div",w,[(0,a.Wm)(R,null,{default:(0,a.w5)((()=>[k])),_:1}),(0,a.Wm)(R,{type:"primary",class:"ml-2"},{default:(0,a.w5)((()=>[x])),_:1})])])),_:1},8,["icon","onBack"]),b,((0,a.wg)(),(0,a.j4)(S,{key:A.tableKey,data:A.list,border:"","table-layout":"fixed","max-height":1e3,style:{width:"800px"},onSortChange:C.sortChange},{default:(0,a.w5)((()=>[(0,a.Wm)(I,{label:"序号",width:"60px",align:"center"},{default:(0,a.w5)((e=>[(0,a.Uk)((0,l.zw)(e.$index+(A.listPagination.pageIndex-1)*A.listPagination.pageSize+1),1)])),_:1}),(0,a.Wm)(I,{prop:"title",label:"章节目录",minWidth:"160px",align:"left"},{default:(0,a.w5)((({row:e})=>[(0,a._)("span",{class:"link-type",onClick:t=>C.readArticle(e)},(0,l.zw)(e.title),9,_)])),_:1}),(0,a.Wm)(I,{label:"操作",align:"center",width:"120","class-name":"small-padding fixed-width"},{default:(0,a.w5)((({row:e})=>[(0,a.Wm)(R,{type:"primary",size:"small",onClick:t=>C.readArticle(e)},{default:(0,a.w5)((()=>[y])),_:2},1032,["onClick"])])),_:1})])),_:1},8,["data","onSortChange"])),(0,a.wy)((0,a.Wm)(N,{total:A.total,page:A.listPagination.pageIndex,"onUpdate:page":t[2]||(t[2]=e=>A.listPagination.pageIndex=e),limit:A.listPagination.pageSize,"onUpdate:limit":t[3]||(t[3]=e=>A.listPagination.pageSize=e),onPagination:C.getList},null,8,["total","page","limit","onPagination"]),[[s.F8,A.total>0]])],512),[[s.F8,!A.inReader]]),(0,a.wy)((0,a._)("div",L,[(0,a.Wm)(D,{ref:"reader",changeMode:C.changeMode,inReader:A.inReader,bookId:C.encode(A.bookName),bookName:A.bookName,articleData:A.articleData,chapterList:A.chapterList},null,8,["changeMode","inReader","bookId","bookName","articleData","chapterList"])],512),[[s.F8,A.inReader]])])}i(2801);var A=i(5691),C=i(2441),v={name:"BookList",components:{Pagination:A.Z,YunReader:C.Z},data(){return{fileList:[],file:null,bookText:"",chapterList:[],bookName:"",articleData:"",listPagination:{sort:"id",sortType:"desc",pageIndex:1,pageSize:15},tableKey:0,list:[],total:0,isAsc:!0,inReader:!1}},methods:{extractTitles(e){const t=/(正文){0,1}(第)([零〇一二三四五六七八九十百千万a-zA-Z0-9]{1,7})[章节卷集部篇回]((?! {4}).)((?!\t{1,4}).){0,30}\r?\n/g;let i=[],a=null;a=e.match(t),a&&i.push(...a);for(let l=0;l<i.length;l++)i[l]=i[l].replace("\r","").replace("\n","").replace("\t","");return i},getChapters(){var e=performance.now();const t=!1;this.list=[];const i=/^(第)([零〇一二三四五六七八九十百千万a-zA-Z0-9]{1,7})[章节卷集部篇回季](.){0,30}|^【(.{1,30})】$/,a=this.bookText;let l=a.replaceAll("\r\n","\n").replaceAll("\r","\n").split("\n").map((e=>e.trim())).filter((e=>e.length>0)),s=0,n=[],o=[];for(let c=0;c<l.length;c++){if(i.test(l[c]))if(0==c)o.push(l[c]);else{const e=l.slice(s,c);0==o.length&&0==s&&o.push("前言"),o.push(l[c]),n.push(e),s=c}if(c==l.length-1){const e=l.slice(s,c+1);0==o.length&&o.push(e[0].slice(0,10)),n.push(e)}}t&&console.log("chapters",n),t&&console.log("titles",o),this.chapterList=[];for(let c=0;c<n.length;c++)this.chapterList.push({id:c,title:o[c],content:n[c]});this.listPagination.pageIndex=1,this.getList();var r=performance.now();console.log("getChapters 耗时",r-e+"ms")},getList(){this.list=[],this.total=this.chapterList.length;const e=this.listPagination.pageIndex,t=this.listPagination.pageSize;if(this.isAsc){const i=(e-1)*t,a=i+t;for(let e=i;e<a&&e<this.total;e++)this.list.push({id:this.chapterList[e].id,title:this.chapterList[e].title})}else{const i=this.total-1-(e-1)*t,a=i-t;for(let e=i;e>a&&e>=0;e--)this.list.push({id:this.chapterList[e].id,title:this.chapterList[e].title})}},readArticle(e){this.inReader=!this.inReader,e&&(this.$refs.reader.currentChapter=e.id)},beforeAnalysis(e){const t="text/plain"==e.type,i=e.size/1024/1024<50;return t||this.$message.error("选择的文件只能是 txt 格式!"),i||this.$message.error("选择的文件大小不能超过 50MB!"),t&&i},encode(e){let t=encodeURI(e),i=btoa(t);return i},onChange(){this.$refs.upload.abort(),this.$refs.upload.clearFiles();var e=e||window.event,t=e.target.files[0];this.file=t,this.bookName=t.name.split(".").slice(0,-1).join("."),this.beforeAnalysis(t);var i=new FileReader;i.onload=e=>{const a=e.target.result;-1===a.indexOf("�")?(this.bookText=a,this.getChapters()):i.readAsText(t,"gb2312")},i.readAsText(t)},changeMode(){this.inReader=!this.inReader},sortChange(){this.isAsc=!this.isAsc,this.getList(),this.listPagination.pageIndex=1},goBack(){}}},P=i(89);const W=(0,P.Z)(v,[["render",z]]);var R=W}}]);
//# sourceMappingURL=96.6de94012.js.map