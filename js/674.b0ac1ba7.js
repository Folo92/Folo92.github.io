"use strict";(self["webpackChunkyun_admin"]=self["webpackChunkyun_admin"]||[]).push([[674],{5691:function(e,t,i){i.d(t,{Z:function(){return d}});var s=i(3396),a=i(7139);function o(e,t,i,o,n,l){const r=(0,s.up)("el-pagination");return(0,s.wg)(),(0,s.iD)("div",{class:(0,a.C_)([{hidden:i.hidden},"pagination-container"])},[(0,s.Wm)(r,(0,s.dG)({background:i.background,"current-page":l.currentPage,"onUpdate:current-page":t[0]||(t[0]=e=>l.currentPage=e),"page-size":l.pageSize,"onUpdate:page-size":t[1]||(t[1]=e=>l.pageSize=e),layout:i.layout,"page-sizes":i.pageSizes,total:i.total},e.$attrs,{onSizeChange:l.handleSizeChange,onCurrentChange:l.handleCurrentChange}),null,16,["background","current-page","page-size","layout","page-sizes","total","onSizeChange","onCurrentChange"])],2)}Math.easeInOutQuad=function(e,t,i,s){return e/=s/2,e<1?i/2*e*e+t:(e--,-i/2*(e*(e-2)-1)+t)};var n=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||function(e){window.setTimeout(e,1e3/60)}}();function l(e){document.documentElement.scrollTop=e,document.body.parentNode.scrollTop=e,document.body.scrollTop=e}function r(){return document.documentElement.scrollTop||document.body.parentNode.scrollTop||document.body.scrollTop}function h(e,t,i){const s=r(),a=e-s,o=20;let h=0;t="undefined"===typeof t?500:t;var c=function(){h+=o;var e=Math.easeInOutQuad(h,s,a,t);l(e),h<t?n(c):i&&"function"===typeof i&&i()};c()}var c={name:"Pagination",props:{total:{required:!0,type:Number},page:{type:Number,default:1},limit:{type:Number,default:20},pageSizes:{type:Array,default(){return[10,20,30,50]}},layout:{type:String,default:"total, sizes, prev, pager, next, jumper"},background:{type:Boolean,default:!0},autoScroll:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1}},computed:{currentPage:{get(){return this.page},set(e){this.$emit("update:page",e)}},pageSize:{get(){return this.limit},set(e){this.$emit("update:limit",e)}}},methods:{handleSizeChange(e){this.$emit("pagination",{page:this.currentPage,limit:e}),this.autoScroll&&h(0,800)},handleCurrentChange(e){this.$emit("pagination",{page:e,limit:this.pageSize}),this.autoScroll&&h(0,800)}}},p=i(89);const g=(0,p.Z)(c,[["render",o],["__scopeId","data-v-15ef1945"]]);var d=g},1924:function(e,t,i){i.d(t,{Z:function(){return Xe}});var s=i(3396),a=i(7139),o=i(9242);const n={class:"reader-head"},l={class:"header-text"},r={style:{margin:"10px 0 0 10px",height:"40px"}},h={class:"custom-tabs-label"},c=(0,s._)("span",{style:"margin-left:4px;font-size:18px"},"目录",-1),p=["onClick"],g={class:"custom-tabs-label"},d=(0,s._)("span",{style:"margin-left:4px;font-size:18px"},"书签",-1),u={key:0,style:{color:"#777777","text-align":"center","margin-top":"20px"}},m=["onClick"],f={class:"bookmark-item-title"},x={class:"bookmark-item-small-text"},b={class:"bookmark-item-preview"},S={class:"custom-tabs-label"},C=(0,s._)("span",{style:"margin-left:4px;font-size:18px"},"笔记",-1),k={key:0,style:{color:"#777777","text-align":"center","margin-top":"20px"}},y=["onClick"],w={class:"bookmark-item-title"},P={class:"bookmark-item-small-text"},v={class:"bookmark-item-preview"},_={style:{margin:"10px 10px","user-select":"none"}},T=(0,s._)("span",{style:{"margin-right":"15px"}},"发音",-1),I={style:{width:"280px",float:"right",color:"var(--el-text-color-secondary)","font-size":"14px"}},z={style:{"margin-top":"20px"}},W=(0,s._)("span",null,"语速",-1),V=(0,s._)("span",null,"音量",-1),L=(0,s._)("span",null,"音调",-1),O=(0,s._)("span",{style:{"margin-right":"20px"}},"开关",-1),N={style:{"margin-top":"20px"}},H=(0,s.Uk)("开始"),D=(0,s.Uk)("继续"),A=(0,s.Uk)("暂停"),M=(0,s.Uk)("停止"),F=(0,s._)("span",null,"字号",-1),R=(0,s._)("span",null,"行间距",-1),j=(0,s._)("span",null,"段间距",-1),B=(0,s._)("span",null,"标题放大",-1),E=(0,s._)("span",null,"上边距",-1),U=(0,s._)("span",null,"下边距",-1),$=(0,s._)("span",null,"侧边距",-1),K=(0,s._)("span",null,"阅读器宽度",-1),Y=(0,s._)("div",{style:{"margin-bottom":"10px"}},"字体",-1),J=(0,s._)("div",{style:{"margin-top":"15px"}},"预览效果",-1),q=(0,s._)("div",{style:{"font-size":"30px"}},"Hello 这是预览",-1),G=(0,s._)("div",{style:{"font-size":"24px"}},"Hello 这是预览",-1),X=(0,s._)("div",{style:{"font-size":"18px"}},"Hello 这是预览",-1),Z=[q,G,X],Q={class:"theme-setbar"},ee=(0,s._)("span",{style:{"margin-right":"10px"}},"主题",-1),te={style:{float:"right"}},ie=["onClick"],se={key:0},ae={key:1},oe=(0,s._)("span",{style:{"margin-right":"10px"}},"纹理",-1),ne={style:{float:"right"}},le=["onClick"],re={class:"color-setbar",style:{clear:"right"}},he=(0,s._)("span",null,"文字",-1),ce={style:{float:"right",width:"180px","line-height":"30px"}},pe={class:"color-setbar",style:{clear:"right"}},ge=(0,s._)("span",null,"背景",-1),de={style:{float:"right",width:"180px","line-height":"30px"}},ue={class:"color-setbar",style:{clear:"right"}},me=(0,s._)("span",null,"边框",-1),fe={style:{float:"right",width:"180px","line-height":"30px"}},xe={style:{"margin-bottom":"10px"}},be=(0,s._)("div",{style:{"margin-bottom":"10px"}},"翻页效果",-1),Se=(0,s._)("div",{style:{"margin-top":"20px","margin-bottom":"10px"}},"默认设置",-1),Ce=(0,s.Uk)("恢复默认设置"),ke={style:{margin:"10px 10px","user-select":"none"}},ye={style:{display:"flex","justify-content":"center"}},we={style:{margin:"5px 10px","user-select":"none"}},Pe={style:{"text-align":"center"}},ve={style:{color:"var(--el-text-color-secondary)"}},_e={style:{margin:"0"}},Te={style:{display:"inline-block","text-align":"center",width:"180px"}},Ie={style:{"text-align":"center","margin-top":"5px"}},ze=(0,s.Uk)(" 添加书签 "),We={style:{"user-select":"none"}},Ve={class:"popmenu-title"},Le={style:{clear:"both"}},Oe=(0,s.Uk)("开始朗读"),Ne=(0,s.Uk)("继续朗读"),He=(0,s.Uk)("暂停朗读"),De=(0,s.Uk)("停止朗读"),Ae=(0,s.Uk)("删除笔记"),Me={style:{"line-height":"30px"}},Fe=["onClick","onMousedown"],Re={class:"reader-foot"},je={class:"footer-text",style:{float:"left","text-align":"left","margin-left":"10px"}},Be={key:0,class:"footer-text",style:{float:"right","text-align":"right","margin-right":"10px"}};function Ee(e,t,i,q,G,X){const Ee=(0,s.up)("Back"),Ue=(0,s.up)("el-icon"),$e=(0,s.up)("calendar"),Ke=(0,s.up)("el-tab-pane"),Ye=(0,s.up)("CollectionTag"),Je=(0,s.up)("Remove"),qe=(0,s.up)("Edit"),Ge=(0,s.up)("el-tabs"),Xe=(0,s.up)("List"),Ze=(0,s.up)("CaretLeft"),Qe=(0,s.up)("CaretRight"),et=(0,s.up)("ArrowLeftBold"),tt=(0,s.up)("ArrowRightBold"),it=(0,s.up)("el-option"),st=(0,s.up)("el-select"),at=(0,s.up)("el-slider"),ot=(0,s.up)("el-divider"),nt=(0,s.up)("el-switch"),lt=(0,s.up)("el-button"),rt=(0,s.up)("VideoPlay"),ht=(0,s.up)("el-popover"),ct=(0,s.up)("el-color-picker"),pt=(0,s.up)("el-radio-button"),gt=(0,s.up)("el-radio-group"),dt=(0,s.up)("Tools"),ut=(0,s.up)("el-input"),mt=(0,s.up)("Search"),ft=(0,s.up)("CirclePlus"),xt=(0,s.up)("Odometer"),bt=(0,s.up)("CloseBold");return(0,s.wg)(),(0,s.iD)("div",null,[(0,s._)("div",{class:"reader-container",style:(0,a.j5)({width:G.pageWidth+20+"px",backgroundColor:G.colorSettings.borderColor,"--page-text-color":G.colorSettings.textColor,"--page-bg-color":G.colorSettings.bgColor,"--page-border-color":G.colorSettings.borderColor}),onMousewheel:t[57]||(t[57]=(...e)=>X.wheelHandle&&X.wheelHandle(...e))},[(0,s._)("div",n,[(0,s._)("span",l,(0,a.zw)(X.getTitle()),1)]),(0,s.Wm)(o.uT,{name:"catalogFade"},{default:(0,s.w5)((()=>[(0,s.wy)((0,s._)("div",{class:"catalog-container",style:(0,a.j5)({"user-select":"none",height:G.pageHeight+"px",width:X.getCatalogWidth()+"px"})},[(0,s._)("div",r,[(0,s.Wm)(Ue,{class:"catalog-button",size:24,onClick:X.closeCatalog},{default:(0,s.w5)((()=>[(0,s.Wm)(Ee)])),_:1},8,["onClick"]),(0,s._)("span",{class:"catalog-title",style:(0,a.j5)("width:"+(X.getCatalogWidth()-70)+"px;")},(0,a.zw)(i.bookName),5)]),(0,s.Wm)(Ge,{class:"catalog-tabs","tab-position":"bottom",stretch:!0},{default:(0,s.w5)((()=>[(0,s.Wm)(Ke,null,{label:(0,s.w5)((()=>[(0,s._)("span",h,[(0,s.Wm)(Ue,{style:"top:2px;font-size:16px"},{default:(0,s.w5)((()=>[(0,s.Wm)($e)])),_:1}),c])])),default:(0,s.w5)((()=>[(0,s._)("div",{ref:"catalogPane",style:(0,a.j5)("overflow: auto; height:"+(G.pageHeight-120)+"px")},[(0,s._)("div",{style:(0,a.j5)({height:G.catalogBeforeHeight+"px"})},null,4),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(X.chapterListRendered,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t,class:"catalog-item",style:(0,a.j5)("font-weight:"+(e.id===G.currentChapter?"bold":"normal")+";color:"+(e.id===G.currentChapter?"#990066":"#252525")),onClick:t=>X.selectChapter(e.id)},(0,a.zw)(e.title),13,p)))),128)),(0,s._)("div",{style:(0,a.j5)({height:G.catalogAfterHeight+"px"})},null,4)],4)])),_:1}),(0,s.Wm)(Ke,null,{label:(0,s.w5)((()=>[(0,s._)("span",g,[(0,s.Wm)(Ue,{style:"top:2px;font-size:16px"},{default:(0,s.w5)((()=>[(0,s.Wm)(Ye)])),_:1}),d])])),default:(0,s.w5)((()=>[(0,s._)("div",{style:(0,a.j5)("overflow: auto; height:"+(G.pageHeight-120)+"px")},[G.bookmarks.length?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",u," 暂时没有书签 ")),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(G.bookmarks,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t,class:"bookmark-item",onClick:e=>X.jumpToBookmark(t)},[(0,s._)("div",f,[(0,s._)("span",{style:(0,a.j5)("width:"+(X.getCatalogWidth()-70)+"px;")},(0,a.zw)(i.chapterList[e.chapter].title),5),(0,s.Wm)(Ue,{class:"link-type",style:{float:"right","margin-right":"20px"},size:18,onClick:(0,o.iM)((e=>X.deleteBookmark(t)),["stop"])},{default:(0,s.w5)((()=>[(0,s.Wm)(Je)])),_:2},1032,["onClick"])]),(0,s._)("div",x,[(0,s._)("span",null,(0,a.zw)(e.time)+" ",1),(0,s._)("span",null,(0,a.zw)(e.chapter+" / "+i.chapterList.length),1)]),(0,s._)("div",b,(0,a.zw)(X.getBookmarkPreview(t)),1)],8,m)))),128))],4)])),_:1}),(0,s.Wm)(Ke,null,{label:(0,s.w5)((()=>[(0,s._)("span",S,[(0,s.Wm)(Ue,{style:"top:2px;font-size:16px"},{default:(0,s.w5)((()=>[(0,s.Wm)(qe)])),_:1}),C])])),default:(0,s.w5)((()=>[(0,s._)("div",{style:(0,a.j5)("overflow: auto; height:"+(G.pageHeight-120)+"px")},[G.notes.length?(0,s.kq)("",!0):((0,s.wg)(),(0,s.iD)("div",k," 暂时没有笔记 ")),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(G.notes,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{key:t,class:"bookmark-item",onClick:e=>X.jumpToNote(t)},[(0,s._)("div",w,[(0,s._)("span",{style:(0,a.j5)("width:"+(X.getCatalogWidth()-70)+"px;")},(0,a.zw)("评述："+(""===e.remark?"(空)":e.remark)),5),(0,s.Wm)(Ue,{class:"link-type",style:{float:"right","margin-right":"20px"},size:18,onClick:(0,o.iM)((e=>X.deleteNote(t)),["stop"])},{default:(0,s.w5)((()=>[(0,s.Wm)(Je)])),_:2},1032,["onClick"])]),(0,s._)("div",P,[(0,s._)("span",null,(0,a.zw)(e.time)+" ",1),(0,s._)("span",null,(0,a.zw)(X.limitText(i.chapterList[e.chapter].title,22)),1)]),(0,s._)("div",v,[(0,s._)("span",{style:(0,a.j5)("background-color:"+e.color)},(0,a.zw)(X.getNotePreview(t)),5)])],8,y)))),128))],4)])),_:1})])),_:1})],4),[[o.F8,G.catalogVisible]])])),_:1}),(0,s._)("div",{class:"body-button-container",style:(0,a.j5)("width: "+G.pageWidth+"px;visibility:"+(G.catalogVisible?"hidden":"inherit"))},[(0,s._)("span",{class:"body-button goback",onClick:t[0]||(t[0]=(...e)=>X.handleGoBack&&X.handleGoBack(...e))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(Ee)])),_:1})]),(0,s._)("span",{class:"body-button catalog",style:(0,a.j5)("bottom: "+-G.pageHeight+"px"),onClick:t[1]||(t[1]=(...e)=>X.openCatalog&&X.openCatalog(...e))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(Xe)])),_:1})],4),(0,s._)("span",{class:"body-button prevchapter",style:(0,a.j5)("left: "+G.pageWidth/3+"px"),onClick:t[2]||(t[2]=e=>X.handleDebounce(X.prevChapter))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(Ze)])),_:1})],4),(0,s._)("span",{class:"body-button nextchapter",style:(0,a.j5)("left: "+2*G.pageWidth/3+"px"),onClick:t[3]||(t[3]=e=>X.handleDebounce(X.nextChapter))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(Qe)])),_:1})],4),(0,s._)("span",{class:"body-button prevpage",style:(0,a.j5)("top: "+G.pageHeight/2+"px"),onClick:t[4]||(t[4]=e=>X.handleDebounce(X.prevPage)),onDblclick:t[5]||(t[5]=e=>X.handleDebounce(X.firstPage,50))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(et)])),_:1})],36),(0,s._)("span",{class:"body-button nextpage",style:(0,a.j5)("top: "+G.pageHeight/2+"px"),onClick:t[6]||(t[6]=e=>X.handleDebounce(X.nextPage)),onDblclick:t[7]||(t[7]=e=>X.handleDebounce(X.lastPage,50))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(tt)])),_:1})],36),(0,s.Wm)(ht,{visible:G.voiceVisible,placement:"top-end","show-arrow":!1,width:G.popoverWidth},{reference:(0,s.w5)((()=>[(0,s._)("span",{class:"body-button voice",style:(0,a.j5)("bottom: "+-G.pageHeight+"px"),onClick:t[16]||(t[16]=(...e)=>X.openVoice&&X.openVoice(...e))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(rt)])),_:1})],4)])),default:(0,s.w5)((()=>[(0,s._)("div",_,[(0,s._)("div",null,[T,(0,s.Wm)(st,{modelValue:G.voiceIndex,"onUpdate:modelValue":t[8]||(t[8]=e=>G.voiceIndex=e),placeholder:"请选择","no-match-text":"默认",style:{width:"252px"},onChange:t[9]||(t[9]=t=>e.changeVoice())},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(G.voiceList,((t,i)=>((0,s.wg)(),(0,s.j4)(it,{key:i,label:e.voiceNameFormat(t),value:i},{default:(0,s.w5)((()=>[(0,s._)("span",I,(0,a.zw)(i+1+" - "+e.voiceNameFormat(t)),1)])),_:2},1032,["label","value"])))),128))])),_:1},8,["modelValue"])]),(0,s._)("div",z,[W,(0,s.Wm)(at,{modelValue:G.speechOptions.rate,"onUpdate:modelValue":t[10]||(t[10]=e=>G.speechOptions.rate=e),min:.1,max:3,step:.1,"show-input":"",class:"setting-slider"},null,8,["modelValue","min","step"])]),(0,s._)("div",null,[V,(0,s.Wm)(at,{modelValue:G.speechOptions.volume,"onUpdate:modelValue":t[11]||(t[11]=e=>G.speechOptions.volume=e),min:0,max:1,step:.05,"show-input":"",class:"setting-slider"},null,8,["modelValue","step"])]),(0,s._)("div",null,[L,(0,s.Wm)(at,{modelValue:G.speechOptions.pitch,"onUpdate:modelValue":t[12]||(t[12]=e=>G.speechOptions.pitch=e),min:0,max:2,step:.1,"show-input":"",class:"setting-slider"},null,8,["modelValue","step"])]),(0,s.Wm)(ot,{"border-style":"dashed",style:{margin:"10px 0"}}),(0,s._)("div",null,[(0,s._)("span",null,(0,a.zw)("定时 ( "+G.speechTimeLeft+" 分钟 )"),1),(0,s.Wm)(at,{modelValue:G.speechTimeLeft,"onUpdate:modelValue":t[13]||(t[13]=e=>G.speechTimeLeft=e),"show-stops":"",min:0,max:120,step:10,class:"setting-slider"},null,8,["modelValue"]),O,(0,s.Wm)(nt,{disabled:!G.isSpeaking,modelValue:G.timedSpeechOpen,"onUpdate:modelValue":t[14]||(t[14]=e=>G.timedSpeechOpen=e),onChange:e.timedSpeech},null,8,["disabled","modelValue","onChange"])]),(0,s.Wm)(ot,{"border-style":"dashed",style:{margin:"5px 0"}}),(0,s._)("div",N,[(0,s.Wm)(lt,{type:"primary",plain:"",round:"",onClick:t[15]||(t[15]=t=>e.speechStart(0))},{default:(0,s.w5)((()=>[H])),_:1}),(0,s.Wm)(lt,{type:"primary",plain:"",round:"",onClick:e.speechResume},{default:(0,s.w5)((()=>[D])),_:1},8,["onClick"]),(0,s.Wm)(lt,{type:"primary",plain:"",round:"",onClick:e.speechPause},{default:(0,s.w5)((()=>[A])),_:1},8,["onClick"]),(0,s.Wm)(lt,{type:"primary",plain:"",round:"",onClick:e.speechStop},{default:(0,s.w5)((()=>[M])),_:1},8,["onClick"])])])])),_:1},8,["visible","width"]),(0,s.Wm)(ht,{visible:G.settingsVisible,"popper-class":"popover-settings",placement:"bottom-end",width:G.popoverWidth},{reference:(0,s.w5)((()=>[(0,s._)("span",{class:"body-button settings",onClick:t[29]||(t[29]=(...e)=>X.openSettings&&X.openSettings(...e))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(dt)])),_:1})])])),default:(0,s.w5)((()=>[(0,s.Wm)(Ge,{type:"border-card",style:{"min-height":"510px","user-select":"none"}},{default:(0,s.w5)((()=>[(0,s.Wm)(Ke,{label:"排版"},{default:(0,s.w5)((()=>[F,(0,s.Wm)(at,{modelValue:G.sizeSettings.fontSize,"onUpdate:modelValue":t[17]||(t[17]=e=>G.sizeSettings.fontSize=e),min:12,max:48,step:1,"show-input":"",class:"setting-slider"},null,8,["modelValue"]),R,(0,s.Wm)(at,{modelValue:G.sizeSettings.lineHeight,"onUpdate:modelValue":t[18]||(t[18]=e=>G.sizeSettings.lineHeight=e),min:1,max:2,step:.1,"show-input":"",class:"setting-slider"},null,8,["modelValue","step"]),j,(0,s.Wm)(at,{modelValue:G.sizeSettings.paraSpace,"onUpdate:modelValue":t[19]||(t[19]=e=>G.sizeSettings.paraSpace=e),min:0,max:1,step:.1,"show-input":"",class:"setting-slider"},null,8,["modelValue","step"]),B,(0,s.Wm)(at,{modelValue:G.sizeSettings.titleScale,"onUpdate:modelValue":t[20]||(t[20]=e=>G.sizeSettings.titleScale=e),min:1,max:3,step:.1,"show-input":"",class:"setting-slider"},null,8,["modelValue","step"]),(0,s.Wm)(ot,{"border-style":"dashed",style:{margin:"10px 0"}}),E,(0,s.Wm)(at,{modelValue:G.sizeSettings.paddingTop,"onUpdate:modelValue":t[21]||(t[21]=e=>G.sizeSettings.paddingTop=e),min:0,max:40,step:2,"show-input":"",class:"setting-slider"},null,8,["modelValue"]),U,(0,s.Wm)(at,{modelValue:G.sizeSettings.paddingBottom,"onUpdate:modelValue":t[22]||(t[22]=e=>G.sizeSettings.paddingBottom=e),min:0,max:40,step:2,"show-input":"",class:"setting-slider"},null,8,["modelValue"]),$,(0,s.Wm)(at,{modelValue:G.sizeSettings.paddingLR,"onUpdate:modelValue":t[23]||(t[23]=e=>G.sizeSettings.paddingLR=e),min:0,max:40,step:2,"show-input":"",class:"setting-slider"},null,8,["modelValue"]),K,(0,s.Wm)(at,{modelValue:G.sizeSettings.widthPercent,"onUpdate:modelValue":t[24]||(t[24]=e=>G.sizeSettings.widthPercent=e),min:20,max:80,step:5,"show-input":"",class:"setting-slider"},null,8,["modelValue"])])),_:1}),(0,s.Wm)(Ke,{label:"字体"},{default:(0,s.w5)((()=>[(0,s._)("div",null,[Y,((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.fonts,((e,t)=>((0,s.wg)(),(0,s.iD)("div",{style:{margin:"2px 2px",display:"inline-block"},key:t},[(0,s.Wm)(lt,{type:G.sizeSettings.fontFamily===e?"primary":"default",onClick:t=>G.sizeSettings.fontFamily=e},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(e),1)])),_:2},1032,["type","onClick"])])))),128)),J,(0,s._)("div",{style:(0,a.j5)({"font-family":G.sizeSettings.fontFamily,margin:"5px 0","text-align":"center"})},Z,4)])])),_:1}),(0,s.Wm)(Ke,{label:"颜色"},{default:(0,s.w5)((()=>[(0,s._)("div",Q,[ee,(0,s._)("div",te,[((0,s.wg)(),(0,s.iD)(s.HY,null,(0,s.Ko)([[0,0],[0,1],[0,2],[5,4],[3,8],[0,5],[2,9],[7,8]],((t,i)=>((0,s.wg)(),(0,s.iD)(s.HY,{key:i},[(0,s._)("span",{class:"text-button",style:(0,a.j5)("color:"+e.textColors[t[0]]+";background-color:"+e.bgColors[t[1]]),onClick:i=>{G.colorSettings.textColor=e.textColors[t[0]],G.colorSettings.bgColor=e.bgColors[t[1]]}},"主题"+(0,a.zw)(i+1),13,ie),3===i?((0,s.wg)(),(0,s.iD)("br",se)):(0,s.kq)("",!0),3===i?((0,s.wg)(),(0,s.iD)("br",ae)):(0,s.kq)("",!0)],64)))),64))])]),(0,s.Wm)(ot,{"border-style":"dashed"}),(0,s._)("div",null,[oe,(0,s._)("div",ne,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.bgTextures,((e,t)=>((0,s.wg)(),(0,s.iD)("span",{key:t,class:"text-button",style:(0,a.j5)({"margin-right":"5px",background:"url("+e+")"}),onClick:t=>G.colorSettings.bgColor="url("+e+")"},"  ",12,le)))),128))])]),(0,s.Wm)(ot,{"border-style":"dashed"}),(0,s._)("div",re,[he,(0,s.Wm)(ct,{modelValue:G.colorSettings.textColor,"onUpdate:modelValue":t[25]||(t[25]=e=>G.colorSettings.textColor=e),"show-alpha":"",predefine:e.predefineColors},null,8,["modelValue","predefine"]),(0,s._)("div",ce,[(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.textColors.slice(0,5),((e,t)=>((0,s.wg)(),(0,s.j4)(lt,{key:t,size:"small",color:e,onClick:t=>G.colorSettings.textColor=e,class:"color-button"},null,8,["color","onClick"])))),128))]),(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.textColors.slice(5,10),((e,t)=>((0,s.wg)(),(0,s.j4)(lt,{key:t,size:"small",color:e,onClick:t=>G.colorSettings.textColor=e,class:"color-button"},null,8,["color","onClick"])))),128))])])]),(0,s._)("div",pe,[ge,(0,s.Wm)(ct,{modelValue:G.colorSettings.bgColor,"onUpdate:modelValue":t[26]||(t[26]=e=>G.colorSettings.bgColor=e),"show-alpha":"",predefine:e.predefineColors},null,8,["modelValue","predefine"]),(0,s._)("div",de,[(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.bgColors.slice(0,5),((e,t)=>((0,s.wg)(),(0,s.j4)(lt,{key:t,size:"small",color:e,onClick:t=>G.colorSettings.bgColor=e,class:"color-button"},null,8,["color","onClick"])))),128))]),(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.bgColors.slice(5,10),((e,t)=>((0,s.wg)(),(0,s.j4)(lt,{key:t,size:"small",color:e,onClick:t=>G.colorSettings.bgColor=e,class:"color-button"},null,8,["color","onClick"])))),128))])])]),(0,s._)("div",ue,[me,(0,s.Wm)(ct,{modelValue:G.colorSettings.borderColor,"onUpdate:modelValue":t[27]||(t[27]=e=>G.colorSettings.borderColor=e),"show-alpha":"",predefine:e.predefineColors},null,8,["modelValue","predefine"]),(0,s._)("div",fe,[(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.bgColors.slice(0,5),((e,t)=>((0,s.wg)(),(0,s.j4)(lt,{key:t,size:"small",color:e,onClick:t=>G.colorSettings.borderColor=e,class:"color-button"},null,8,["color","onClick"])))),128))]),(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.bgColors.slice(5,10),((e,t)=>((0,s.wg)(),(0,s.j4)(lt,{key:t,size:"small",color:e,onClick:t=>G.colorSettings.borderColor=e,class:"color-button"},null,8,["color","onClick"])))),128))])])])])),_:1}),(0,s.Wm)(Ke,{label:"其他"},{default:(0,s.w5)((()=>[(0,s._)("div",xe,[be,(0,s.Wm)(gt,{modelValue:G.pageTurning,"onUpdate:modelValue":t[28]||(t[28]=e=>G.pageTurning=e)},{default:(0,s.w5)((()=>[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.pageTurningModes,((e,t)=>((0,s.wg)(),(0,s.j4)(pt,{key:t,label:e},null,8,["label"])))),128))])),_:1},8,["modelValue"]),Se,(0,s.Wm)(lt,{onClick:X.resetStyle},{default:(0,s.w5)((()=>[Ce])),_:1},8,["onClick"])])])),_:1})])),_:1})])),_:1},8,["visible","width"]),(0,s.Wm)(ht,{visible:G.searchVisible,"popper-class":"popover-search",placement:"bottom","show-arrow":!1,width:G.popoverWidth,offset:-30,onHide:t[35]||(t[35]=e=>G.tempParaIndex=null)},{reference:(0,s.w5)((()=>[(0,s._)("span",{class:"body-button search",style:(0,a.j5)("left: "+G.pageWidth/2+"px"),onClick:t[34]||(t[34]=(...e)=>X.openSearch&&X.openSearch(...e))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:30},{default:(0,s.w5)((()=>[(0,s.Wm)(mt)])),_:1})],4)])),default:(0,s.w5)((()=>[(0,s._)("div",ke,[(0,s._)("div",ye,[(0,s.Wm)(lt,{style:{margin:"0 10px","align-self":"center"},size:"small",icon:"ArrowLeftBold",round:"",onClick:t[30]||(t[30]=e=>X.handleSearch(G.keywords,!0))}),(0,s.Wm)(ut,{modelValue:G.keywords,"onUpdate:modelValue":t[31]||(t[31]=e=>G.keywords=e),placeholder:"全文搜索","prefix-icon":"Search",clearable:"",onKeyup:t[32]||(t[32]=(0,o.D2)((e=>X.handleSearch(G.keywords)),["enter"]))},null,8,["modelValue"]),(0,s.Wm)(lt,{style:{margin:"0 10px","align-self":"center"},size:"small",icon:"ArrowRightBold",round:"",onClick:t[33]||(t[33]=e=>X.handleSearch(G.keywords))})])])])),_:1},8,["visible","width"]),(0,s.Wm)(ht,{visible:G.progressVisible,placement:"top","show-arrow":!1,width:G.popoverWidth,offset:-30},{reference:(0,s.w5)((()=>[(0,s._)("span",{class:"body-button progress",style:(0,a.j5)("left: "+G.pageWidth/2+"px;bottom: "+-G.pageHeight+"px"),onClick:t[41]||(t[41]=(...e)=>X.openProgress&&X.openProgress(...e))},[(0,s.Wm)(Ue,{class:"body-button-icon",size:32},{default:(0,s.w5)((()=>[(0,s.Wm)(xt)])),_:1})],4)])),default:(0,s.w5)((()=>[(0,s._)("div",we,[(0,s._)("div",Pe,[(0,s._)("span",ve,"当前进度："+(0,a.zw)(G.progress)+"%",1)]),(0,s._)("div",_e,[(0,s.Wm)(lt,{style:{"margin-right":"20px"},size:"small",icon:"ArrowLeftBold",round:"",onClick:t[36]||(t[36]=e=>X.handleDebounce(X.prevChapter))}),(0,s._)("div",Te,[(0,s.Wm)(at,{modelValue:G.progress,"onUpdate:modelValue":t[37]||(t[37]=e=>G.progress=e),min:0,max:100,step:.1,"show-tooltip":!1,onClick:t[38]||(t[38]=e=>X.jumpTo(G.progress)),onChange:X.jumpTo},null,8,["modelValue","step","onChange"])]),(0,s.Wm)(lt,{style:{"margin-left":"20px"},size:"small",icon:"ArrowRightBold",round:"",onClick:t[39]||(t[39]=e=>X.handleDebounce(X.nextChapter))})]),(0,s._)("div",Ie,[(0,s._)("span",{class:"link-type",style:{"font-size":"16px"},onClick:t[40]||(t[40]=(...e)=>X.addBookmark&&X.addBookmark(...e))},[(0,s.Wm)(Ue,{size:18,style:{top:"4px"}},{default:(0,s.w5)((()=>[(0,s.Wm)(ft)])),_:1}),ze])])])])),_:1},8,["visible","width"]),(0,s._)("span",{class:"body-button home",style:(0,a.j5)("left: "+G.pageWidth/2+"px;bottom: "+-G.pageHeight+"px;visibility:visible"),onClick:t[42]||(t[42]=(...e)=>X.closePopover&&X.closePopover(...e))},null,4),(0,s.Wm)(ht,{visible:G.menuVisible,"popper-class":"popover-menu","show-arrow":!1,placement:G.menuPlacement,width:195,offset:0},{reference:(0,s.w5)((()=>[(0,s._)("span",{style:(0,a.j5)({position:"absolute",left:G.menuOffsetX+"px",top:G.menuOffsetY+"px"})},null,4)])),default:(0,s.w5)((()=>[(0,s._)("div",We,[(0,s._)("div",Ve,[(0,s._)("span",null,(0,a.zw)(X.limitText(X.getCurrentParaText(),8)),1),(0,s.Wm)(Ue,{class:"link-type",style:{float:"right","margin-bottom":"10px"},size:18,onClick:t[43]||(t[43]=e=>G.menuVisible=!1)},{default:(0,s.w5)((()=>[(0,s.Wm)(bt)])),_:1})]),(0,s._)("div",Le,[(0,s.Wm)(lt,{class:"menu-button-short",size:"small",type:"primary",plain:"",onClick:t[44]||(t[44]=t=>(e.speechStart(G.currentPara),X.closePopover()))},{default:(0,s.w5)((()=>[Oe])),_:1}),(0,s.Wm)(lt,{class:"menu-button-short",style:{"margin-left":"9px"},size:"small",type:"primary",plain:"",onClick:t[45]||(t[45]=t=>(e.speechResume(),X.closePopover()))},{default:(0,s.w5)((()=>[Ne])),_:1}),(0,s.Wm)(lt,{class:"menu-button-short",style:{"margin-left":"0"},size:"small",type:"primary",plain:"",onClick:t[46]||(t[46]=t=>(e.speechPause(),X.closePopover()))},{default:(0,s.w5)((()=>[He])),_:1}),(0,s.Wm)(lt,{class:"menu-button-short",style:{"margin-left":"9px"},size:"small",type:"primary",plain:"",onClick:t[47]||(t[47]=t=>(e.speechStop(),X.closePopover()))},{default:(0,s.w5)((()=>[De])),_:1})]),(0,s.Wm)(ot,{"border-style":"dashed",style:{margin:"5px 0"}}),(0,s.Wm)(ut,{modelValue:G.noteRemark,"onUpdate:modelValue":t[48]||(t[48]=e=>G.noteRemark=e),placeholder:"输入评论","prefix-icon":"Edit",clearable:"",type:"textarea",style:{margin:"5px 0"},resize:"none",autosize:{minRows:1,maxRows:3},maxlength:500,onKeyup:t[49]||(t[49]=(0,o.D2)((e=>X.addNote(G.currentPara,G.noteRemark,G.noteColor,!0)),["enter"]))},null,8,["modelValue"]),(0,s.Wm)(lt,{class:"menu-button",size:"small",type:"primary",icon:"Plus",plain:"",onClick:t[50]||(t[50]=e=>X.addNote(G.currentPara,G.noteRemark,G.noteColor,!0))},{default:(0,s.w5)((()=>[(0,s.Uk)((0,a.zw)(X.searchMarkedPara(G.currentPara)>-1?"修改":"添加")+"笔记",1)])),_:1}),(0,s.wy)((0,s.Wm)(lt,{class:"menu-button",style:{"margin-left":"0"},size:"small",type:"primary",icon:"Minus",plain:"",onClick:t[51]||(t[51]=e=>X.handleDeleteNote(G.currentPara))},{default:(0,s.w5)((()=>[Ae])),_:1},512),[[o.F8,X.searchMarkedPara(G.currentPara)>-1]]),(0,s._)("div",Me,[(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.markedColors.slice(0,5),((e,t)=>((0,s.wg)(),(0,s.j4)(lt,{key:t,size:"small",color:e,onClick:t=>G.noteColor=e,style:(0,a.j5)({border:G.noteColor===e?"1px dashed #222":"1px solid #FFF"})},null,8,["color","onClick","style"])))),128))]),(0,s._)("div",null,[((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(e.markedColors.slice(5,10),((e,t)=>((0,s.wg)(),(0,s.j4)(lt,{key:t,size:"small",color:e,onClick:t=>G.noteColor=e,style:(0,a.j5)({border:G.noteColor===e?"1px dashed #222":"1px solid #FFF"})},null,8,["color","onClick","style"])))),128))])])])])),_:1},8,["visible","placement"])],4),(0,s._)("div",{class:"reader-body",ref:"readerBody",style:(0,a.j5)({"font-size":G.sizeSettings.fontSize+"px","font-family":G.sizeSettings.fontFamily,"line-height":G.sizeSettings.lineHeight,"padding-top":G.sizeSettings.paddingTop+"px","padding-bottom":G.sizeSettings.paddingBottom+"px","padding-left":G.sizeSettings.paddingLR+"px","padding-right":G.sizeSettings.paddingLR+"px",height:G.pageHeight+"px",color:G.colorSettings.textColor,background:G.colorSettings.bgColor,"background-position":Math.floor(G.currentPage/(G.pageList.length??1)*100)+"%",overflow:"滚动"===G.pageTurning?"auto":"visible"}),onClick:t[54]||(t[54]=(...e)=>X.closePopover&&X.closePopover(...e)),onMousedown:t[55]||(t[55]=(...e)=>X.handleMouseDown&&X.handleMouseDown(...e)),onMouseup:t[56]||(t[56]=(...e)=>X.handleMouseup&&X.handleMouseup(...e))},[X.hasNoIndentPara()?((0,s.wg)(),(0,s.iD)("p",{key:0,class:"main-para",style:(0,a.j5)({margin:G.sizeSettings.paraSpace*G.sizeSettings.fontSize+"px 0","text-indent":0,color:e.getParaTextColor(0),"background-color":e.getParaBgColor(0),"text-shadow":e.getTextShadow(0)}),onClick:t[52]||(t[52]=t=>e.speechFromPara(0)),onMousedown:t[53]||(t[53]=e=>G.currentPara=0)},(0,a.zw)(X.noIndentPara),37)):(0,s.kq)("",!0),((0,s.wg)(!0),(0,s.iD)(s.HY,null,(0,s.Ko)(X.indentParas,((t,i)=>((0,s.wg)(),(0,s.iD)("p",{key:i,class:"main-para",style:(0,a.j5)({margin:G.sizeSettings.paraSpace*G.sizeSettings.fontSize+"px 0","font-size":X.getParaFontSize(i)+"px","font-weight":0===i&&0===G.currentPage?"bold":"normal",color:X.hasNoIndentPara()?e.getParaTextColor(i+1):e.getParaTextColor(i),"background-color":X.hasNoIndentPara()?e.getParaBgColor(i+1):e.getParaBgColor(i),"text-shadow":X.hasNoIndentPara()?e.getTextShadow(i+1):e.getTextShadow(i)}),onClick:t=>e.speechFromPara(""==X.noIndentPara?i:i+1),onMousedown:e=>G.currentPara=""==X.noIndentPara?i:i+1},(0,a.zw)(t),45,Fe)))),128))],36),(0,s._)("div",Re,[(0,s._)("span",je,(0,a.zw)("desktop"===G.device?G.currentChapter+1+" / "+(i.chapterList.length??0)+" 章 ":"")+(0,a.zw)(G.currentPage+1+" / "+(G.pageList.length??0)+" 页"),1),"desktop"===G.device?((0,s.wg)(),(0,s.iD)("span",Be,"字数："+(0,a.zw)(X.getPageWordNum())+"/"+(0,a.zw)(X.getTotalWordNum()),1)):(0,s.kq)("",!0)])],36)])}var Ue=i(65),$e={beforeCreate(){this.pageTurningModes=["无","覆盖","平移","拟真","滚动"],this.fonts=["Arial","楷体","宋体","黑体","方正楷体_GBK","方正楷体_简体","思源宋体_中","思源宋体_细","思源黑体_粗","思源黑体_常规","思源黑体_细","思源黑体_极细","思源柔黑_中","思源柔黑_细","思源柔黑_极细"],this.textColors=["#000000","#3D3D3D","#555555","#336699","#336666","#990033","#FF6666","#ffd04b","#FFCCCC","#FAFAFA"],this.bgColors=["#EEE0C6","#CCEACC","#FAFAFA","#EFEFEF","#CCCCCC","#669999","#F0DAD2","#6699CC","#282828","#000000"],this.borderColors=["#EEE0C6","#CCEACC","#FAFAFA","#EFEFEF","#CCCCCC","#669999","#F0DAD2","#6699CC","#282828","#000000"],this.bgTextures=[i(2281),i(70),i(4241),i(9148),i(8736)],this.predefineColors=["#ff4500","#ff8c00","#ffd700","#90ee90","#00ced1","#1e90ff","#c71585","rgba(255, 69, 0, 0.68)","rgb(255, 120, 0)","hsv(51, 100, 98)","hsva(120, 40, 94, 0.5)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#c7158577"],this.markedColors=["#ff000020","#ff450060","#ff8c0060","#ffd70060","#90ee9060","#00ced160","#1e90ff60","#c7158560","rgba(255, 69, 0, 0.68)","hsl(181, 100%, 37%)","hsla(209, 100%, 56%, 0.73)","#42b983"]}},Ke={beforeMount(){this.canvasContext=document.createElement("canvas").getContext("2d")},methods:{repage(e){this.repaging(e)},repaging(e){this.pageList=[],this.currentPage=0,this.noIndent=[];const t=!1;t&&console.log(">>>>>>>>>>>>> REPAIGING START >>>>>>>>>>>>>");let i=[],s=0,a=0,o=0,n=0,l="",r=2;const h=this.textareaWidth,c=this.textareaHeight,p=this.sizeSettings.fontSize,g=p*this.sizeSettings.paraSpace,d=()=>0===n?p*this.sizeSettings.titleScale:p,u=()=>d()*this.sizeSettings.lineHeight;t&&console.log("lineHeight =",u(),", maxHeight =",c);while(n<e.length){if(t&&console.log(">>>>>> PARA START >>>>>>"),s=a,(i.length>0||this.sizeSettings.paddingTop>0)&&(a+=g),1==i.length&&a>=c?(l=i[0],i=[],o=this.getParaLines(l,h,d(),r*p),s=0):(r=2,l=e[n],o=this.getParaLines(l,h,d(),r*p),a+=u()*o),t&&console.log("paraText",l),t&&console.log("fontSize = ",d()),t&&console.log("lineWidth = ",h),t&&console.log("lineHeight = ",u()),t&&console.log("paraSpace = ",g),t&&console.log("paraLines =",o),t&&console.log("previosHeight = ",s),t&&console.log("currentHeight1 = ",a),t&&void 0===l[0]&&console.log("第",this.pageList.length,"页 第",i.length+1,"段之前出现 undefined"),a<c)i.push(l),e.length===n+1&&this.pageList.push(i);else{const m=Math.floor((c-s-g)/u());if(t&&console.log("****** spareLines",m),m<1)t&&console.log("spareLines < 1"),this.pageList.push(i),i=[l],e.length===n+1&&this.pageList.push(i),a=o*u()+(this.sizeSettings.paddingTop>0?g:0);else{t&&console.log("spareLines >= 1");let s=this.getSliceIndex(l,h,d(),r*p,m);t&&console.log("sliceText",l.slice(0,s)),s<l.length?(t&&console.log("sliceIndex < paraText.length"),i.push(l.slice(0,s)),this.pageList.push(i),this.noIndent.push(this.pageList.length),r=0,i=[l.slice(s)],o=this.getParaLines(i[0],h,d(),r*p),a=o*u()+(this.sizeSettings.paddingTop>0?g:0),a>=c?n--:e.length===n+1&&this.pageList.push(i)):(t&&console.log("sliceIndex >= paraText.length"),i.push(l),this.pageList.push(i),i=[],a=0)}}t&&console.log("currentHeight2 = ",a),t&&console.log(">>>>>> PARA END >>>>>>"),n++}},getSliceIndex(e,t,i,s,a){return this.calcParaLayout(e,t,i,s,a)},getParaLines(e,t,i,s){return this.calcParaLayout(e,t,i,s)},calcParaLayout(e,t,i,s,a=0){const o=!1,n=",.?;:)}]，。？；：’”）】』》、…",l="({[‘“（【『《",r="—…",h=e.length;if(void 0===e[0])return 0;let c=0,p=1,g=0,d=0,u=s;const m=Math.floor(t/i)-4;g+=m-2,u+=this.measureText(e.slice(d,g),i);while(g<h){if(c=this.measureText(e[g],i),o&&console.log("text[index]",e[g]),o&&console.log(u,t,c),u<=t-c)u+=c;else{let t=0;while(l.indexOf(e[g-1])>-1&&g>1&&t<5)o&&console.log("nonBackChars text[index-1]",e[g-1]),g--,t++;t=0;while(n.indexOf(e[g])>-1&&g>0&&t<5)o&&console.log("nonFrontChars text[index]",e[g]),g--,t++;t=0;while(r.indexOf(e[g])>-1&&e[g]===e[g-1]&&g>1&&t<5)o&&console.log("nonBreakChars text[index]",e[g]),g--,t++;if(o&&console.log("lineText",e.slice(d,g)),o&&console.log("currentWidth",u),d=g,a>0&&p>=a)break;p++,g+=m,u=this.measureText(e.slice(d,g+1),i)}g++}return o&&console.log("lines =",p),a>0?g:p},measureText(e,t){const i=this.sizeSettings.fontFamily,s=`${t}px ${i}`;this.canvasContext.font=s;const{width:a}=this.canvasContext.measureText(e);return a}}},Ye={methods:{getFocusColor(e,t,i="#DD66CC",s=10){const a=(e,t)=>{let i=e+t;return(i<0||i>255)&&(i=e-t),i},o=(e,t,i)=>(Math.abs(e-i)<s&&(i=a(e,s)),Math.abs(t-i)<s&&(i=a(i,s)),i);let n=e.replace(/#/g,"").match(/[\da-z]{2}/gi),l=t.replace(/#/g,"").match(/[\da-z]{2}/gi),r=i.replace(/#/g,"").match(/[\da-z]{2}/gi);n=n.map((e=>parseInt(e,16))),l=l.map((e=>parseInt(e,16))),l=r.map((e=>parseInt(e,16)));let h=[o(n[0],l[0],r[0]),o(n[1],l[1],r[1]),o(n[2],l[2],r[2])],c="#"+h.reduce(((e,t)=>e+("0"+t.toString(16)).slice(-2)),"");return c},getParaTextColor(e){if(this.isSpeaking&&this.readingPara==this.getParaIndexCh(e)&&this.readingChapter==this.currentChapter)return this.getFocusColor(this.colorSettings.textColor,this.colorSettings.bgColor,"#DD66CC")},getTextShadow(e){return this.isSpeaking&&this.readingPara==this.getParaIndexCh(e)&&this.readingChapter==this.currentChapter?"1px 1px 1px #999999":"0 0 0"},getParaBgColor(e){if(this.isSpeaking&&this.readingPara==this.getParaIndexCh(e)&&this.readingChapter==this.currentChapter)return this.getClosedColor(this.colorSettings.bgColor,-20)},timedSpeech(){this.timedSpeechOpen?this.timedSpeechInterval=setInterval((()=>{this.speechTimeLeft--,this.speechTimeLeft<=0&&(this.speechStop(),clearInterval(this.timedSpeechInterval),this.timedSpeechOpen=!1,this.speechTimeLeft)}),6e4):clearInterval(this.timedSpeechInterval)},autoSpeechTask(e=this.readingPara,t=this.readingChapter,i=!1,s=500){let a=50;const o=this.chapterList[this.readingChapter].content[this.readingPara];let n=o.match(/[$0-9\u4e00-\u9fa5\uf900-\ufa2d]/g);n&&n.length&&(a+=320*n.length),n=o.match(/[a-zA-Z]/g),n&&n.length&&(a+=160*n.length),a=Math.floor(a/this.utterance.rate);const l=Math.min(.6*a,s);if(this.readingStatus.paraIndex==this.readingPara&&this.readingStatus.chapterIndex==this.readingChapter){this.readingStatus.time+=this.isPaused?0:l;const e=1.2*a+3e3;if(this.readingStatus.time>e)return this.readingStatus={paraIndex:-1,chapterIndex:-1,time:0},void this.speechFromPara(this.getParaIndex(this.readingPara))}else this.readingStatus={paraIndex:this.readingPara,chapterIndex:this.readingChapter,time:0};clearTimeout(this.autoSpeechTimer),this.autoSpeechTimer=setTimeout((()=>{this.autoSpeech(e,t,i)}),l)},autoSpeech(e=this.readingPara,t=this.readingChapter,i=!1){const s=!1;if(s&&console.log("autoSpeech readingPara",this.readingPara),speechSynthesis.pending)s&&console.log("当前有播放任务，且后面仍有任务排队"),this.autoSpeechTask(e,t);else if(speechSynthesis.speaking){s&&console.log("当前有播放任务，后面没有任务排队"),this.readingPara=e,this.readingChapter=t,this.currentChapter<this.readingChapter?(s&&console.log("当前章节在前面"),this.currentChapter=this.readingChapter,this.$nextTick((()=>{this.readingPage=this.getPageIndex(this.readingPara),this.currentPage=this.getPageIndex(this.readingPara)}))):this.currentChapter===this.readingChapter&&(s&&console.log("当前就是朗读章节"),this.readingPage=this.getPageIndex(this.readingPara),this.currentPage<this.readingPage&&(this.currentPage=this.readingPage,s&&console.log("当前页在朗读页的前面 this.currentPage",this.currentPage)));let i=this.chapterList[this.readingChapter].content;this.readingPara+1<i.length?(this.speak(i[this.readingPara+1]),this.autoSpeechTask(this.readingPara+1,t)):this.readingChapter+1<this.chapterList.length?(this.speak(this.chapterList[this.readingChapter+1].content[0]),this.autoSpeechTask(0,this.readingChapter+1,!1,50)):this.autoSpeechTask(e,t,!0)}else{if(i)return this.isSpeaking=!1,void(this.isPaused=!1);s&&console.log("当前没有播放任务，开始初始内容"),this.speak(this.chapterList[t].content[e]),this.autoSpeechTask(e,t)}},speak(e){if(/[$0-9a-zA-Z\u4e00-\u9fa5\uf900-\ufa2d]/.test(e))this.utterance.text=e,speechSynthesis.speak(this.utterance);else{const e=new SpeechSynthesisUtterance;e.text="a",e.volume=0,speechSynthesis.speak(e)}},speechFromPara(e){this.utterance&&speechSynthesis.speaking&&(this.speechStop(),this.readingPara=this.getParaIndexCh(e),this.readingPage=this.currentPage,this.readingChapter=this.currentChapter,this.isSpeaking=!0,this.isPaused=!1,this.autoSpeech())},speechStart(e=0){this.utterance?(this.speechStop(),this.utterance.text=this.pageList[this.currentPage],this.utterance.lang="zh-CN",this.utterance.rate=this.speechOptions.rate,this.utterance.volume=this.speechOptions.volume,this.utterance.pitch=this.speechOptions.pitch,this.utterance.voice=this.voiceList[this.voiceIndex],this.readingPara=this.getParaIndexCh(e),this.readingPage=this.currentPage,this.readingChapter=this.currentChapter,this.isSpeaking=!0,this.isPaused=!1,this.autoSpeech()):this.showMessage({message:"浏览器不支持",type:"error",duration:1e3})},getVoiceList(){this.utterance&&(speechSynthesis.getVoices(),setTimeout((()=>{this.voiceList=speechSynthesis.getVoices().filter((e=>e.lang.indexOf("zh")>-1))}),100))},changeVoice(){this.utterance.lang="zh-CN",this.utterance.rate=this.speechOptions.rate,this.utterance.volume=this.speechOptions.volume,this.utterance.pitch=this.speechOptions.pitch,this.utterance.voice=this.voiceList[this.voiceIndex],this.speechOptions.voiceIndex=this.voiceIndex,speechSynthesis.speaking&&(this.speechStop(),this.isSpeaking=!0,this.isPaused=!1,this.autoSpeech())},speechResume(){this.utterance&&(speechSynthesis.resume(),this.isPaused=!1)},speechPause(){this.utterance&&(speechSynthesis.pause(),this.isPaused=!0)},speechStop(){this.utterance&&(this.isSpeaking=!1,this.isPaused=!1,clearTimeout(this.autoSpeechTimer),speechSynthesis.cancel())},voiceNameFormat(e){return e.name.replace("Microsoft","微软").replace("Online","在线").replace(" (Natural)","").replace("Chinese","中文").replace("Mainland","大陆").replace("Northeastern Mandarin","东北话").replace("Zhongyuan Mandarin Shaanxi","陕西话").replace("Hong Kong","香港").replace("Cantonese Traditional","广东话").replace("Taiwanese Mandarin","台湾普通话").replace("Taiwan","台湾")}},watch:{}},Je={name:"YunReader",props:["changeMode","inReader","bookId","bookName","articleData","chapterList"],mixins:[$e,Ke,Ye],data(){return{store:(0,Ue.oR)(),screenWidth:document.body.clientWidth,screenHeight:document.body.clientHeight,pageWidth:960,pageHeight:1020,textareaWidth:720,textareaHeight:900,popoverWidth:342,pageTurning:"拟真",sizeSettings:{fontFamily:"Arial",fontSize:24,lineHeight:1.5,paraSpace:.5,titleScale:2,paddingTop:20,paddingBottom:20,paddingLR:20,widthPercent:50},colorSettings:{textColor:this.textColors[0],bgColor:this.bgColors[0],borderColor:"#FAFAFA"},pageList:[],noIndent:[],currentChapter:0,currentPage:0,currentPara:0,readingChapter:0,readingPage:0,readingPara:0,bookmarks:[],lastPosition:{chapter:0,para:0},notes:[],noteRemark:"",noteColor:"",progress:0,keywords:"",tempParaIndex:null,tempStartIndex:-1,catalogRenderMax:100,catalogScrollPercent:0,catalogBeforeHeight:0,catalogAfterHeight:0,timer:null,messageTimer:null,wheelTimer:null,sizeSettingsTimer:null,speechOptionTimer:null,timedSpeechInterval:null,autoSpeechTimer:null,screenSizeTimer:null,device:"desktop",menuVisible:!1,menuOffsetX:0,menuOffsetY:0,menuPlacement:"bottom",settingsVisible:!1,catalogVisible:!1,voiceVisible:!1,searchVisible:!1,progressVisible:!1,isWheelLocked:!1,turnLocked:!1,utterance:window.SpeechSynthesisUtterance?new SpeechSynthesisUtterance:null,voiceList:[],voiceIndex:"默认",speechOptions:{rate:1,volume:1,pitch:1,voiceIndex:0},isSpeaking:!1,isPaused:!1,speechTimeLeft:60,timedSpeechOpen:!1,readingStatus:{paraIndex:-1,chapterIndex:-1,time:0}}},created(){},mounted(){const e=localStorage.getItem("SIZE_SETTINGS");e&&e.length&&(this.sizeSettings=JSON.parse(e));const t=localStorage.getItem("COLOR_SETTINGS");t&&t.length&&(this.colorSettings=JSON.parse(t));const i=localStorage.getItem("PAGE_TURNING");i&&i.length&&(this.pageTurning=i);const s=localStorage.getItem("SPEECH_OPTIONS");s&&s.length&&(this.speechOptions=JSON.parse(s)),this.voiceIndex=this.speechOptions.voiceIndex,this.device=this.store.state.app.device;const a=localStorage.getItem("LASTPOSITION_"+this.bookId,JSON.stringify(this.lastPosition));a&&(this.lastPosition=JSON.parse(a),this.currentChapter=this.lastPosition.chapter,this.currentPage=this.getPageIndex(this.lastPosition.para)),window.onresize=()=>(()=>{this.screenWidth=document.body.clientWidth,this.screenHeight=document.body.clientHeight})(),document.onkeydown=e=>{switch(e.key){case"ArrowLeft":case"a":this.handleDebounce(this.prevPage);break;case"ArrowUp":case"w":this.handleDebounce(this.prevChapter);break;case"ArrowRight":case"d":this.handleDebounce(this.nextPage);break;case"ArrowDown":case"s":this.handleDebounce(this.nextChapter);break;default:break}};const o=this.handleThrottle(this.setRenderArea,100);this.$refs.catalogPane.onscroll=()=>{o()}},beforeUnmount(){this.speechStop()},methods:{resetStyle(){this.sizeSettings={fontFamily:"Arial",fontSize:24,lineHeight:1.5,paraSpace:.5,titleScale:2,paddingTop:20,paddingBottom:20,paddingLR:20,widthPercent:50},this.colorSettings={textColor:this.textColors[0],bgColor:this.bgColors[0],borderColor:"#FAFAFA"}},pageInit(){if("desktop"===this.device){const e=this.sizeSettings.widthPercent?this.sizeSettings.widthPercent:50;this.pageWidth=this.screenWidth*(e/100),this.pageHeight=window.innerHeight-220}else"mobile"===this.store.state.app.device&&(this.pageWidth=.95*this.screenWidth,this.pageHeight=window.screen.height-100);this.textareaWidth=this.pageWidth-2*this.sizeSettings.paddingLR,"滚动"===this.pageTurning?this.textareaHeight=1e5:this.textareaHeight=this.pageHeight-this.sizeSettings.paddingTop-this.sizeSettings.paddingBottom,console.log(`宽:${this.pageWidth}(${this.textareaWidth}) , 高:${this.pageHeight}(${this.textareaHeight})`)},setRenderArea(){const e=30,t=this.chapterList.length*e,i=this.$refs.catalogPane.scrollTop,s=this.chapterListRendered.length*e,a=Math.max(i-s/2,0),o=t-a-s;this.catalogScrollPercent=i/t,this.catalogBeforeHeight=a,this.catalogAfterHeight=o>0?o:150,this.$nextTick((()=>{this.$refs.catalogPane.scrollTop=i}))},handleDebounce(e,t=100){clearTimeout(this.timer),this.timer=setTimeout((()=>{e()}),t)},handleThrottle(e,t=100){let i=!0;return function(){i&&(i=!1,setTimeout((()=>{e(),i=!0}),t))}},combineFn(e,t){e.forEach(((e,i)=>e(...t[i])))},showMessage(e){clearTimeout(this.messageTimer),this.messageTimer=setTimeout((()=>this.$message(e)),200)},fullscreen(e){let t=document.getElementsByClassName(e)[0];document.fullscreenElement?document.exitFullscreen&&document.exitFullscreen():t.requestFullscreen()},prevChapter(){this.currentChapter>0?(this.currentChapter--,this.clearSelection()):this.showMessage({message:"已到达第一章",type:"info",duration:1e3})},firstPage(){this.currentPage=0,this.clearSelection()},prevPage(){0===this.currentPage?this.currentChapter>0?(this.currentChapter--,this.$nextTick((()=>{this.lastPage(),this.clearSelection()}))):this.showMessage({message:"已到达第一页",type:"info",duration:1e3}):(this.currentPage--,this.clearSelection())},nextPage(){this.currentPage===this.pageTotal-1?this.currentChapter<this.chapterList.length-1?(this.currentChapter++,this.clearSelection()):this.showMessage({message:"已到达最后一页",type:"info",duration:1e3}):(this.currentPage++,this.clearSelection())},lastPage(){if(this.currentPage===this.pageTotal-1)return!1;this.currentPage=this.pageTotal-1,this.clearSelection()},nextChapter(){this.currentChapter<this.chapterList.length-1?(this.currentChapter++,this.clearSelection()):this.showMessage({message:"已到达最后一章",type:"info",duration:1e3})},jumpTo(e){this.currentChapter=Math.floor((this.chapterList.length-1)*e/100),this.clearSelection()},wheelHandle(e){if(!this.isWheelLocked&&"滚动"!=this.pageTurning){const t=50;e.deltaY>0?(clearTimeout(this.wheelTimer),this.wheelTimer=setTimeout((()=>this.nextPage()),t)):e.deltaY<0&&(clearTimeout(this.wheelTimer),this.wheelTimer=setTimeout((()=>this.prevPage()),t))}},animatePage(e){let t=document.querySelector(".reader-container"),i=document.querySelector(".reader-body"),s=i.cloneNode(1);const a=this.pageWidth;let o,n;if(s.style.position="absolute",s.style.width=a+"px",s.style.left="10px",s.style.top="30px",s.style.boxShadow=6*(e?-1:1)+"px 0px 6px 1px rgb(128 131 137 / 25%)",t.appendChild(s),"覆盖"===this.pageTurning){o=400;const t=(e?1:-1)*a;n=[{transform:"translateX(0px)"},{transform:"translateX("+.5*t+"px)"},{transform:"translateX("+.9*t+"px)"},{transform:"translateX("+t+"px)"}]}else if("平移"===this.pageTurning){o=400;const s=(e?1:-1)*a;n=[{transform:"translateX(0px)"},{transform:"translateX("+.5*s+"px)"},{transform:"translateX("+.9*s+"px)"},{transform:"translateX("+s+"px)"}],this.$nextTick((()=>{let s=i.cloneNode(1);s.style.position="absolute",s.style.width=a+"px",s.style.left=(e?-1:1)*a+10+"px",s.style.top="30px",t.appendChild(s),s.animate(n,{duration:o,iterations:1,fill:"forwards",delay:0,easing:"ease-out"}),setTimeout((()=>{t.removeChild(s)}),o)}))}else"拟真"===this.pageTurning&&(o=1200,s.style.transformOrigin=e?"right":"left",n=e?[{transform:"rotateY(0)"},{transform:"rotateY(100deg)"},{transform:"rotateY(180deg)"}]:[{transform:"rotateY(0deg)"},{transform:"rotateY(-100deg)"},{transform:"rotateY(-180deg)"}]);s.animate(n,{duration:o,iterations:1,fill:"forwards",delay:0,easing:"ease-out"}),setTimeout((()=>{t.removeChild(s)}),o)},closePopover(){this.menuVisible=!1,this.settingsVisible=!1,this.voiceVisible=!1,this.searchVisible=!1,this.progressVisible=!1,this.closeCatalog()},handleGoBack(){this.menuVisible=!1,this.settingsVisible=!1,this.voiceVisible=!1,this.searchVisible=!1,this.progressVisible=!1,this.closeCatalog(),this.speechStop(),this.changeMode()},openCatalog(){this.menuVisible=!1,this.settingsVisible=!1,this.voiceVisible=!1,this.searchVisible=!1,this.progressVisible=!1,this.catalogVisible=!0,this.isWheelLocked=!0,this.$nextTick((()=>{const e=this.currentChapter/this.chapterList.length,t=30*this.chapterList.length;this.$refs.catalogPane.scrollTop=e*t-(this.pageHeight-120)/3}));const e=localStorage.getItem("BOOKMARKS_"+this.bookId);e&&(this.bookmarks=JSON.parse(e))},selectChapter(e){this.currentChapter=e,this.closeCatalog()},openSettings(){this.settingsVisible=!this.settingsVisible,this.menuVisible=!1,this.voiceVisible=!1,this.searchVisible=!1,this.progressVisible=!1},openVoice(){this.voiceVisible=!this.voiceVisible,this.menuVisible=!1,this.settingsVisible=!1,this.searchVisible=!1,this.progressVisible=!1,this.voiceInit()},voiceInit(){this.speechOptions&&this.speechOptions.voiceIndex&&(this.voiceIndex=this.speechOptions.voiceIndex),this.voiceList&&0!==this.voiceList.length||this.getVoiceList()},openSearch(){this.searchVisible=!this.searchVisible,this.menuVisible=!1,this.voiceVisible=!1,this.settingsVisible=!1,this.progressVisible=!1},openProgress(){this.progressVisible=!this.progressVisible,this.menuVisible=!1,this.voiceVisible=!1,this.settingsVisible=!1,this.searchVisible=!1},closeCatalog(){this.catalogVisible=!1,this.isWheelLocked=!1,this.searchVisible=!1},handleSearch(e,t=!1){let i=-1,s=0,a=this.currentChapter,o=this.list;this.tempParaIndex&&this.tempParaIndex>=0?s=this.tempParaIndex:t&&-1===this.tempParaIndex?(a-=1,o=this.chapterList[a]?this.chapterList[a].content:[],s=o.length-1):s=this.getParaIndexCh(0);while(a<this.chapterList.length&&a>=0){while(s<o.length&&s>=0){if(t){const t=-1===this.tempStartIndex?o[s].length-1:this.tempStartIndex;i=o[s].lastIndexOf(e,t-1)}else i=o[s].indexOf(e,this.tempStartIndex+1);if(i>-1)return this.tempStartIndex=i,this.currentChapter=a,this.$nextTick((()=>{this.currentPage=this.getPageIndex(s),this.$nextTick((()=>{const t=this.getParaIndex(s);let a=i,o=i+e.length;const n=this.pageList[this.currentPage][t].length;if(o>n){if(!(a<n))return this.currentPage++,this.$nextTick((()=>{const e=".main-para:nth-child(1)";this.getSelection(e,a-n,o-n)})),void(this.tempParaIndex=s);o=n}const l=".main-para:nth-child("+(t+1)+")";this.getSelection(l,a,o),"滚动"===this.pageTurning&&this.$el.querySelector(l).scrollIntoView({behavior:"smooth",block:"center"})}))})),void(t&&o[s].lastIndexOf(e,i-1)===i?this.tempParaIndex=s-1:this.tempParaIndex=s);s+=t?-1:1,this.tempStartIndex=-1}a+=t?-1:1,a===this.chapterList.length?this.showMessage({message:"后面没有了",type:"info",duration:1e3}):a<0?this.showMessage({message:"前面没有了",type:"info",duration:1e3}):(o=this.chapterList[a]?this.chapterList[a].content:[],s=t?o.length-1:0)}},handleMouseup(e){2===e.button&&this.openPopupMenu(e)},openPopupMenu(e){if(this.settingsVisible=!1,this.voiceVisible=!1,this.searchVisible=!1,this.progressVisible=!1,this.catalogVisible=!1,e.layerX||e.layerY){this.menuOffsetX=e.layerX,this.menuOffsetY=e.layerY;const t=240,i=360;e.layerY>this.pageHeight-i?e.layerX>this.pageWidth-t?this.menuPlacement="top-end":this.menuPlacement="top-start":e.layerX>this.pageWidth-t?this.menuPlacement="bottom-end":this.menuPlacement="bottom-start"}const t=this.searchMarkedPara(this.currentPara);t>-1?(this.noteRemark=this.notes[t].remark,this.noteColor=this.notes[t].color):(this.noteRemark="",""==this.noteColor&&(this.noteColor=this.markedColors[0])),this.menuVisible=!0,this.voiceInit()},handleMouseDown(){this.$refs.readerBody.oncontextmenu=function(){return!1},this.menuVisible=!1},searchMarkedPara(e){for(let t in this.notes){const i=this.getPageIndex(this.notes[t].para),s=this.getParaIndex(this.notes[t].para);if(this.notes[t].chapter===this.currentChapter&&(i===this.currentPage&&s===e||""!=this.noIndentPara&&0===e&&i===this.currentPage-1&&this.getPageIndex(this.notes[t].para+1)===this.currentPage))return t}return-1},addNote(e,t="",i=this.markedColors[0],s=!1){const a=this.searchMarkedPara(e);if(a>-1)if(s||""!=t){let e=this.notes[a];e.remark=t,e.color=i,this.updateNote(a,e)}else this.deleteNote(a);else{const s={chapter:this.currentChapter,para:this.getParaIndexCh(e),time:(new Date).toLocaleDateString().replaceAll("/","-"),remark:t,color:i};this.notes.push(s),localStorage.setItem("NOTES_"+this.bookId,JSON.stringify(this.notes)),this.setTextStyle(),this.showMessage({message:"笔记已添加",type:"success",duration:1e3})}this.closePopover()},updateNote(e,t){this.notes.splice(e,1,t),localStorage.setItem("NOTES_"+this.bookId,JSON.stringify(this.notes)),this.setTextStyle()},deleteNote(e){this.notes.splice(e,1),this.notes.length>0?localStorage.setItem("NOTES_"+this.bookId,JSON.stringify(this.notes)):localStorage.removeItem("NOTES_"+this.bookId),this.setTextStyle()},handleDeleteNote(e){this.deleteNote(this.searchMarkedPara(e)),this.closePopover()},jumpToNote(e){console.log(e,this.notes[e].chapter,this.notes[e].para),this.currentChapter=this.notes[e].chapter,this.$nextTick((()=>{console.log(this.getPageIndex(this.notes[e].para)),this.currentPage=this.getPageIndex(this.notes[e].para)})),this.closeCatalog()},getNotePreview(e){const t=this.chapterList[this.notes[e].chapter].content,i=this.notes[e].para;let s="";return s=t[i].length<40?t[i]+"...":t[i].slice(0,40)+"...",s},addBookmark(){const e=localStorage.getItem("BOOKMARKS_"+this.bookId);e&&(this.bookmarks=JSON.parse(e));const t=this.hasNoIndentPara()&&this.pageList[this.currentPage].length>0?1:0,i={chapter:this.currentChapter,para:this.getParaIndexCh(t),time:(new Date).toLocaleDateString().replaceAll("/","-")};this.bookmarks.push(i),localStorage.setItem("BOOKMARKS_"+this.bookId,JSON.stringify(this.bookmarks)),this.showMessage({message:"书签已添加",type:"success",duration:1e3}),this.closePopover()},deleteBookmark(e){this.bookmarks.splice(e,1),this.bookmarks.length>0?localStorage.setItem("BOOKMARKS_"+this.bookId,JSON.stringify(this.bookmarks)):localStorage.removeItem("BOOKMARKS_"+this.bookId)},jumpToBookmark(e){console.log(e,this.bookmarks[e].chapter,this.bookmarks[e].para),this.currentChapter=this.bookmarks[e].chapter,this.$nextTick((()=>{console.log(this.getPageIndex(this.bookmarks[e].para)),this.currentPage=this.getPageIndex(this.bookmarks[e].para)})),this.closeCatalog()},getBookmarkPreview(e){const t=this.chapterList[this.bookmarks[e].chapter].content,i=this.bookmarks[e].para;let s="";return t[i].length<20?(s=t[i],t[i+1]&&(s+="\r\n"+t[i+1].slice(0,20)),s+="..."):s=t[i].slice(0,40)+"...",s},setTextStyle(){const e=Array.from(this.$el.querySelector(".reader-body").getElementsByTagName("p"));e.forEach(((e,t)=>{e.innerHTML=this.clearStyle(e.innerHTML);const i=this.searchMarkedPara(t);if(i>-1){const t=this.notes[i].color??this.markedColors[0];e.innerHTML=this.insertStyle(e.innerHTML,"background-color:"+t)}}))},insertStyle(e,t){return`<span style="${t}" key="0">${e}</span>`},clearStyle(e){const t=/^(<span style=".*" key="0">)/g,i=/(<\/span>)$/g;return e.replace(t,"").replaceAll(i,"")},clearSelection(){window.getSelection().removeAllRanges()},getSelection(e,t,i){this.$nextTick((()=>{let s=this.$el.querySelector(e),a=document.createRange(),o=s.firstChild;a.setStart(o,t),a.setEnd(o,i);let n=window.getSelection();n.removeAllRanges(),n.addRange(a),a.detach(),a=null}))},getTitle(){return this.chapterList&&this.chapterList[this.currentChapter]?this.chapterList[this.currentChapter].title:this.articleData.title},getParaFontSize(e){return 0===e&&0===this.currentPage?this.sizeSettings.fontSize*this.sizeSettings.titleScale:this.sizeSettings.fontSize},getCatalogWidth(){return this.pageWidth<400?this.pageWidth:400},getPageWordNum(){if(this.currentPage<0)return 0;const e=[],t=this.pageList[this.currentPage];for(let i in t)e.push(t[i].length);return e.reduce(((e,t)=>e+t),0)},getTotalWordNum(){return this.pageList.reduce(((e,t)=>e+t.reduce(((e,t)=>e+t.length),0)),0)},isNoIndent(e){if(!this.noIndent)return!1;for(let t in this.noIndent)if(e===this.noIndent[t])return!0;return!1},hasNoIndentPara(){return!(!this.noIndentPara.length||0===this.noIndentPara.length)},getParaIndexCh(e){let t=e;for(let i=0;i<=this.currentPage;i++)this.isNoIndent(i)&&t--,t+=(this.pageList[i]??"").length;return t-=(this.pageList[this.currentPage]??[]).length,t},getParaIndex(e){let t=e;for(let i=0;i<this.pageList.length;i++)if(this.isNoIndent(i)&&t++,t-=this.pageList[i].length,t<0)return t+this.pageList[i].length},getPageIndex(e){let t=e;for(let i=0;i<this.pageList.length;i++)if(this.isNoIndent(i)&&t++,t-=this.pageList[i].length,t<0)return i},getClosedColor(e,t=10){const i=(e,t)=>{let i=e+t;return(i<0||i>255)&&(i=e-t),i};let s=e.replace(/#/g,"").match(/[\da-z]{2}/gi);s=s.map((e=>i(parseInt(e,16),t)));let a="#"+s.reduce(((e,t)=>e+("0"+t.toString(16)).slice(-2)),"");return a},reverseColor(e){let t="0x"+e.replace(/#/g,""),i="000000"+(16777215-t).toString(16);return"#"+i.substring(i.length-6,i.length)},reverseAvgColor(e,t){let i="0x"+e.replace(/#/g,""),s=16777215-("0x"+t.replace(/#/g,"")),a="000000"+(16777215-((i+s)/2).toFixed(0)).toString(16);return"#"+a.substring(a.length-6,a.length)},getRestText(e,t=this.currentPage){let i="";return this.pageList.forEach(((s,a)=>{a>=t&&s[a].forEach(((t,s)=>{s>=e&&(i+=t)}))})),i},limitText(e="",t){return e.length>t?e.slice(0,t)+"...":e},getCurrentParaText(){const e=this.chapterList[this.currentChapter];if(!e)return"";const t=this.getParaIndexCh(this.currentPara);return e.content[t]}},computed:{list:{get(){return this.chapterList&&this.chapterList[this.currentChapter]?this.chapterList[this.currentChapter].content:this.articleData&&this.articleData.content?this.articleData.content:""}},pageTotal:function(){return this.pageList.length},noIndentPara:function(){return this.isNoIndent(this.currentPage)?this.pageList[this.currentPage][0]:""},indentParas:function(){let e=[];for(let t in this.pageList[this.currentPage])e.push(this.pageList[this.currentPage][t]);return this.isNoIndent(this.currentPage)&&e.shift(),e},chapterListRendered:function(){const e=this.chapterList.length,t=this.catalogRenderMax,i=Math.max(Math.floor(this.catalogScrollPercent*e)-t/2,0);let s=[];for(let a=i;a<i+t&&a<e;a++)s.push({id:this.chapterList[a].id,title:this.chapterList[a].title});return s}},watch:{inReader:{handler(e){if(e){const e=localStorage.getItem("LASTPOSITION_"+this.bookId,JSON.stringify(this.lastPosition));e?(this.lastPosition=JSON.parse(e),this.currentChapter=this.lastPosition.chapter,this.$nextTick((()=>{this.currentPage=this.getPageIndex(this.lastPosition.para)}))):(this.currentChapter=0,this.currentPage=0)}else{const e=this.hasNoIndentPara()&&this.pageList[this.currentPage].length>0?1:0;this.lastPosition={chapter:this.currentChapter,para:this.getParaIndexCh(e)},localStorage.setItem("LASTPOSITION_"+this.bookId,JSON.stringify(this.lastPosition))}}},list:{handler(e){this.repaging(e)}},chapterList:{handler(){const e=localStorage.getItem("NOTES_"+this.bookId);e&&(this.notes=JSON.parse(e));const t=localStorage.getItem("BOOKMARKS_"+this.bookId);t&&(this.bookmarks=JSON.parse(t));const i=this.chapterList.length-this.chapterListRendered.length;this.catalogAfterHeight=30*i},immediate:!0},bookId:{handler(){this.bookmarks=[],this.notes=[]}},sizeSettings:{handler(){clearTimeout(this.sizeSettingsTimer),this.sizeSettingsTimer=setTimeout((()=>{this.pageInit(),this.repage(this.list),localStorage.setItem("SIZE_SETTINGS",JSON.stringify(this.sizeSettings))}),500)},deep:!0},colorSettings:{handler(){localStorage.setItem("COLOR_SETTINGS",JSON.stringify(this.colorSettings))},deep:!0},speechOptions:{handler(){clearTimeout(this.speechOptionTimer),this.speechOptionTimer=setTimeout((()=>{this.changeVoice(),localStorage.setItem("SPEECH_OPTIONS",JSON.stringify(this.speechOptions))}),500)},deep:!0},screenWidth(){clearTimeout(this.screenSizeTimer),this.screenSizeTimer=setTimeout((()=>{this.pageInit(),this.repage(this.list)}),500)},screenHeight(){clearTimeout(this.screenSizeTimer),this.screenSizeTimer=setTimeout((()=>{this.pageInit(),this.repage(this.list)}),500)},currentChapter(e,t){this.progress=parseFloat((e/this.chapterList.length*100).toFixed(1)),"滚动"===this.pageTurning?this.$refs.readerBody.scrollTop=0:"覆盖平移拟真".includes(this.pageTurning)&&!this.turnLocked&&(this.turnLocked=!0,this.animatePage(e<t),setTimeout((()=>{this.turnLocked=!1}),100))},currentPage(e,t){"覆盖平移拟真".includes(this.pageTurning)&&!this.turnLocked&&this.animatePage(e<t)},indentParas(){this.$nextTick((()=>this.setTextStyle()))},pageTurning(e,t){"滚动"!==e&&"滚动"!==t||(this.pageInit(),this.repage(this.list)),localStorage.setItem("PAGE_TURNING",this.pageTurning)}}},qe=i(89);const Ge=(0,qe.Z)(Je,[["render",Ee]]);var Xe=Ge},2281:function(e,t,i){e.exports=i.p+"img/paper01.1674fd9a.jpg"},70:function(e,t,i){e.exports=i.p+"img/paper02.a7bfa9d7.png"},4241:function(e,t,i){e.exports=i.p+"img/paper03.987df7de.png"},9148:function(e,t,i){e.exports=i.p+"img/paper04.68b25bb0.png"},8736:function(e,t,i){e.exports=i.p+"img/paper05.a473d95c.png"}}]);
//# sourceMappingURL=674.b0ac1ba7.js.map